<div class="post_bd" itemprop="articleBody">
            
            <p>很多童鞋应该都有用过 WordPress 的缩略图功能，暂且不说那些形形色色的缩略图插件，Wordpress 2.9 版本之后就新增自带了缩略图的功能，但是不知道你有没有和我同样的感觉，Wordpress 自带的缩略图还是有很大的局限性，比如说只能自动裁剪一个正方形的图片，而不能裁剪成长方形的；又比如说，只能接受站内或者说多媒体库里的图片，对站外图片就无从下手了；再比如说图片所在文件夹不是同一个，不方便管理。总之，Wordpress 自带的缩略图功能并没有我们想象的那样强大，这时候我们需要第三方文件 timthumb.php 项目来帮助我们。</p>
<p>现在我的主题上用到的缩略图都是 timthumb.php 来实现的，具体实例可以看我的首页幻灯片轮播部分，查看相应的幻灯图片的源码可以看到，图片的地址路径是 ****timthumb.php?src=****&amp;h=245&amp;w=560&amp;zc=1 这样的格式，这就是被 timthumb.php 生成的缩略图，很神奇吧。</p>
<p>说了半天，什么是 timthumb.php 呢？这是一个专门为 WordPress 而开发的缩略图应用的项目。有点类似于插件，但是又和 WordPress 插件不同，因为它不是被上传于 plugins 文件夹下，而是需要上传到你的主题文件夹中。你可以在这里<a title="Timthumb" href="http://code.google.com/p/timthumb/" target="_blank">了解和下载最新版本的 timthumb.php</a>，一般默认配置也就可以了，如果想进一步优化可以根据需要修改 timthumb.php 里前30行的参数。</p>
<p>说到 WordPress，纯文字有点太对不起观众，所以最后上一段我自用的缩略图代码，结合了 timthumb.php 和 WordPress 自带的缩略图功能，支持站外链接图片，自动缓存图片。代码如下：</p>
<div class="source" style="font-family: 'Courier New', 'Consolas', 'Lucida Console'; color: #000000;"><span style="color: #008080;">&lt;?php</span><br>
<span style="color: #000080; font-weight: bold;">function</span> <span style="color: #000000;">post_thumbnail</span>( <span style="color: #000000;">$width</span> <span style="color: #000000;">=</span> <span style="color: #0000ff;">100</span><span style="color: #000000;">,</span><span style="color: #000000;">$height</span> <span style="color: #000000;">=</span> <span style="color: #0000ff;">80</span> <span style="color: #000000;">){</span><br>
&nbsp;&nbsp;&nbsp; <span style="color: #000080; font-weight: bold;">global</span> <span style="color: #000000;">$post</span>;<br>
&nbsp;&nbsp;&nbsp; <span style="color: #000080; font-weight: bold;">if</span>( <span style="color: #000000;">has_post_thumbnail</span>() <span style="color: #000000;">){</span>&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//如果有缩略图，则显示缩略图</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$timthumb_src</span> <span style="color: #000000;">=</span> <span style="color: #000000;">wp_get_attachment_image_src</span>(<span style="color: #000000;">get_post_thumbnail_id</span>(<span style="color: #000000;">$post</span><span style="color: #000000;">-&gt;</span><span style="color: #ff0000;">ID</span><span style="color: #000000;">),</span><span style="color: #0000ff;">'full'</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$post_timthumb</span> <span style="color: #000000;">=</span> <span style="color: #0000ff;">'&lt;img src="'</span><span style="color: #000000;">.</span><span style="color: #000000;">get_bloginfo</span>(<span style="color: #0000ff;">"template_url"</span>)<span style="color: #000000;">.</span><span style="color: #0000ff;">'/timthumb.php?src='</span><span style="color: #000000;">.</span><span style="color: #000000;">$timthumb_src</span><span style="color: #000000;">[</span><span style="color: #0000ff;">0</span><span style="color: #000000;">]</span><span style="color: #000000;">.</span><span style="color: #0000ff;">'&amp;amp;h='</span><span style="color: #000000;">.</span><span style="color: #000000;">$height</span><span style="color: #000000;">.</span><span style="color: #0000ff;">'&amp;amp;w='</span><span style="color: #000000;">.</span><span style="color: #000000;">$width</span><span style="color: #000000;">.</span><span style="color: #0000ff;">'&amp;amp;zc=1" alt="'</span><span style="color: #000000;">.</span><span style="color: #000000;">$post</span><span style="color: #000000;">-&gt;</span><span style="color: #ff0000;">post_title</span><span style="color: #000000;">.</span><span style="color: #0000ff;">'" class="thumb" /&gt;'</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000080; font-weight: bold;">echo</span> <span style="color: #000000;">$post_timthumb</span>;<br>
&nbsp;&nbsp;&nbsp; <span style="color: #000000;">}</span> <span style="color: #000080; font-weight: bold;">else</span> <span style="color: #000000;">{</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$post_timthumb</span> <span style="color: #000000;">=</span> <span style="color: #0000ff;">''</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">ob_start</span>();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">ob_end_clean</span>();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$output</span> <span style="color: #000000;">=</span> <span style="color: #000000;">preg_match</span>(<span style="color: #0000ff;">'/&lt;img.+src=[\'"]([^\'"]+)[\'"].*&gt;/i'</span><span style="color: #000000;">,</span> <span style="color: #000000;">$post</span><span style="color: #000000;">-&gt;</span><span style="color: #ff0000;">post_content</span><span style="color: #000000;">,</span> <span style="color: #000000;">$index_matches</span>);&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//获取日志中第一张图片</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$first_img_src</span> <span style="color: #000000;">=</span> <span style="color: #000000;">$index_matches</span> <span style="color: #000000;">[</span><span style="color: #0000ff;">1</span><span style="color: #000000;">];</span>&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//获取该图片 src</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000080; font-weight: bold;">if</span>( <span style="color: #000000;">!</span><span style="color: #000080; font-weight: bold;">empty</span>(<span style="color: #000000;">$first_img_src</span>) <span style="color: #000000;">){</span>&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//如果日志中有图片</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$path_parts</span> <span style="color: #000000;">=</span> <span style="color: #000000;">pathinfo</span>(<span style="color: #000000;">$first_img_src</span>);&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//获取图片 src 信息</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$first_img_name</span> <span style="color: #000000;">=</span> <span style="color: #000000;">$path_parts</span><span style="color: #000000;">[</span><span style="color: #0000ff;">"basename"</span><span style="color: #000000;">];</span>&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//获取图片名</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$first_img_pic</span> <span style="color: #000000;">=</span> <span style="color: #000000;">get_bloginfo</span>(<span style="color: #0000ff;">'wpurl'</span>)<span style="color: #000000;">.</span> <span style="color: #0000ff;">'/cache/'</span><span style="color: #000000;">.</span><span style="color: #000000;">$first_img_name</span>;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//文件所在地址</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$first_img_file</span> <span style="color: #000000;">=</span> <span style="color: #000000;">ABSPATH</span><span style="color: #000000;">.</span> <span style="color: #0000ff;">'cache/'</span><span style="color: #000000;">.</span><span style="color: #000000;">$first_img_name</span>;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//保存地址</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$expired</span> <span style="color: #000000;">=</span> <span style="color: #0000ff;">604800</span>;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//过期时间</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000080; font-weight: bold;">if</span> ( <span style="color: #000000;">!</span><span style="color: #000000;">is_file</span>(<span style="color: #000000;">$first_img_file</span>) || (<span style="color: #000000;">time</span>() <span style="color: #000000;">-</span> <span style="color: #000000;">filemtime</span>(<span style="color: #000000;">$first_img_file</span>)) <span style="color: #000000;">&gt;</span> <span style="color: #000000;">$expired</span> <span style="color: #000000;">){</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">copy</span>(<span style="color: #000000;">$first_img_src</span><span style="color: #000000;">,</span> <span style="color: #000000;">$first_img_file</span>);&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//远程获取图片保存于本地</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$post_timthumb</span> <span style="color: #000000;">=</span> <span style="color: #0000ff;">'&lt;img src="'</span><span style="color: #000000;">.</span><span style="color: #000000;">$first_img_src</span><span style="color: #000000;">.</span><span style="color: #0000ff;">'" alt="'</span><span style="color: #000000;">.</span><span style="color: #000000;">$post</span><span style="color: #000000;">-&gt;</span><span style="color: #ff0000;">post_title</span><span style="color: #000000;">.</span><span style="color: #0000ff;">'" class="thumb" /&gt;'</span>;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//保存时用原图显示</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$post_timthumb</span> <span style="color: #000000;">=</span> <span style="color: #0000ff;">'&lt;img src="'</span><span style="color: #000000;">.</span><span style="color: #000000;">get_bloginfo</span>(<span style="color: #0000ff;">"template_url"</span>)<span style="color: #000000;">.</span><span style="color: #0000ff;">'/timthumb.php?src='</span><span style="color: #000000;">.</span><span style="color: #000000;">$first_img_pic</span><span style="color: #000000;">.</span><span style="color: #0000ff;">'&amp;amp;h='</span><span style="color: #000000;">.</span><span style="color: #000000;">$height</span><span style="color: #000000;">.</span><span style="color: #0000ff;">'&amp;amp;w='</span><span style="color: #000000;">.</span><span style="color: #000000;">$width</span><span style="color: #000000;">.</span><span style="color: #0000ff;">'&amp;amp;zc=1" alt="'</span><span style="color: #000000;">.</span><span style="color: #000000;">$post</span><span style="color: #000000;">-&gt;</span><span style="color: #ff0000;">post_title</span><span style="color: #000000;">.</span><span style="color: #0000ff;">'" class="thumb" /&gt;'</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">}</span> <span style="color: #000080; font-weight: bold;">else</span> <span style="color: #000000;">{</span>&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: #008800;">//如果日志中没有图片，则显示默认</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">$post_timthumb</span> <span style="color: #000000;">=</span> <span style="color: #0000ff;">'&lt;img src="'</span><span style="color: #000000;">.</span><span style="color: #000000;">get_bloginfo</span>(<span style="color: #0000ff;">"template_url"</span>)<span style="color: #000000;">.</span><span style="color: #0000ff;">'/images/default_thumb.gif" alt="'</span><span style="color: #000000;">.</span><span style="color: #000000;">$post</span><span style="color: #000000;">-&gt;</span><span style="color: #ff0000;">post_title</span><span style="color: #000000;">.</span><span style="color: #0000ff;">'" class="thumb" /&gt;'</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000000;">}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #000080; font-weight: bold;">echo</span> <span style="color: #000000;">$post_timthumb</span>;<br>
&nbsp;&nbsp;&nbsp; <span style="color: #000000;">}</span><br>
<span style="color: #000000;">}</span><br>
<span style="color: #008080;">?&gt;</span></div>
<p>可以把这部分函数写进 WordPress 主题的 functions.php 里，然后再用 post_thumbnail( 100,80 ) 这样调用，其中的 $width 和 $height 是必须的参数哟。以上代码不多作解释了，注释都写的蛮详细了。今天就到这里，事情太多，洗洗睡了~</p>
        </div>
